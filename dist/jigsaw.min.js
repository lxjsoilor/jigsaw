/*!
 * version: 1.0.0
 * docs: https://github.com/yeild/jigsaw
 * 
 */!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var r=42,o=9,s=360,a=155,l=Math.PI,c=r+2*o+3;function u(e,t){return Math.round(Math.random()*(t-e)+e)}function d(e,t){var n=document.createElement(e);return n.className=t,n}function f(e,t){e.classList.add(t)}function h(){var e=["../img/1.png","../img/2.png","../img/3.png","../img/4.png","../img/5.png"];return e[Math.floor(Math.random()*(e.length+1))]}function v(e,t,n,i){e.beginPath(),e.moveTo(t,n),e.arc(t+r/2,n-o+2,o,.72*l,2.26*l),e.lineTo(t+r,n),e.arc(t+r+o-2,n+r/2,o,1.21*l,2.78*l),e.lineTo(t+r,n+r),e.lineTo(t,n+r),e.arc(t+o-2,n+r/2,o+.4,2.76*l,1.24*l,!0),e.lineTo(t,n),e.lineWidth=2,e.fillStyle="rgba(0, 0, 0, 0.5)",e.strokeStyle="rgba(0, 0, 0, 0.3)",e.stroke(),e[i](),e.globalCompositeOperation="overlay"}function p(e,t){return e+t}function y(e){return e*e}var m=function(){function e(t){var n=t.el,i=t.onSuccess,r=t.onFail,o=t.onRefresh;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n.style.position=n.style.position||"relative",this.el=n,this.onSuccess=i,this.onFail=r,this.onRefresh=o}return i(e,[{key:"init",value:function(){this.initDOM(),this.initImg(),this.bindEvents()}},{key:"initDOM",value:function(){var e=function(e,t){var n=d("canvas");return n.width=e,n.height=t,n}(s,a),t=e.cloneNode(!0),n=d("div","sliderContainer"),i=d("div","refreshIcon"),r=d("div","sliderMask"),o=d("div","slider"),l=d("span","sliderIcon"),c=d("span","sliderText");t.className="block",c.innerHTML="向右滑动完成拼图";var u=this.el;u.appendChild(e),u.appendChild(t),o.appendChild(l),r.appendChild(o),n.appendChild(r),n.appendChild(c),u.appendChild(n),Object.assign(this,{canvas:e,block:t,sliderContainer:n,refreshIcon:i,slider:o,sliderMask:r,sliderIcon:l,text:c,canvasCtx:e.getContext("2d"),blockCtx:t.getContext("2d")})}},{key:"initImg",value:function(){var e=this,t=function(e){var t=d("img");return t.crossOrigin="Anonymous",t.onload=e,t.onerror=function(){t.src=h()},t.src=h(),t}(function(){e.draw(),e.canvasCtx.drawImage(t,0,0,s,a),e.blockCtx.drawImage(t,0,0,s,a);var n=e.y-2*o-1,i=e.blockCtx.getImageData(e.x-3,n,c,c);e.block.width=c,e.blockCtx.putImageData(i,0,n)});this.img=t}},{key:"draw",value:function(){this.x=u(c+10,s-(c+10)),this.y=u(10+2*o,a-(c+10)),v(this.canvasCtx,this.x,this.y,"fill"),v(this.blockCtx,this.x,this.y,"clip")}},{key:"clean",value:function(){this.canvasCtx.clearRect(0,0,s,a),this.blockCtx.clearRect(0,0,s,a),this.block.width=s}},{key:"bindEvents",value:function(){var e=this;this.el.onselectstart=function(){return!1},this.refreshIcon.onclick=function(){e.reset(),"function"==typeof e.onRefresh&&e.onRefresh()};var t=void 0,n=void 0,i=[],r=!1,o=function(e){t=e.clientX||e.touches[0].clientX,n=e.clientY||e.touches[0].clientY,r=!0},a=function(o){if(!r)return!1;var a=o.clientX||o.touches[0].clientX,l=o.clientY||o.touches[0].clientY,c=a-t,u=l-n;if(c<0||c+38>=s)return!1;e.slider.style.left=c+"px";var d=.9375*c;e.block.style.left=d+"px",f(e.sliderContainer,"sliderContainer_active"),e.sliderMask.style.width=c+"px",i.push(u)},l=function(n){if(!r)return!1;var o,s;if(r=!1,(n.clientX||n.changedTouches[0].clientX)==t)return!1;o=e.sliderContainer,s="sliderContainer_active",o.classList.remove(s),e.trail=i;var a=e.verify(),l=a.spliced,c=a.verified;l?c?(f(e.sliderContainer,"sliderContainer_success"),"function"==typeof e.onSuccess&&e.onSuccess()):(f(e.sliderContainer,"sliderContainer_fail"),e.text.innerHTML="再试一次",e.reset()):(f(e.sliderContainer,"sliderContainer_fail"),"function"==typeof e.onFail&&e.onFail(),setTimeout(function(){e.reset()},1e3))};this.slider.addEventListener("mousedown",o),this.slider.addEventListener("touchstart",o),document.addEventListener("mousemove",a),document.addEventListener("touchmove",a),document.addEventListener("mouseup",l),document.addEventListener("touchend",l)}},{key:"verify",value:function(){var e=this.trail,t=e.reduce(p)/e.length,n=e.map(function(e){return e-t}),i=Math.sqrt(n.map(y).reduce(p)/e.length),r=parseInt(this.block.style.left);return{spliced:Math.abs(r-this.x)<10,verified:0!==i}}},{key:"reset",value:function(){this.sliderContainer.className="sliderContainer",this.slider.style.left=0,this.block.style.left=0,this.sliderMask.style.width=0,this.clean(),this.img.src=h()}}]),e}();window.jigsaw={init:function(e){return new m(e)}}}]);